<Window x:Class="HangMan.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:HangMan.ViewModels"
        xmlns:conv="clr-namespace:HangMan.Converters"
        Title="Hangman Game" 
        Height="650" 
        Width="800"
        MinHeight="550"
        MinWidth="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        KeyDown="Window_KeyDown">
    
    <Window.DataContext>
        <vm:GameViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <conv:StageVisibilityConverter x:Key="StageVisibility"/>
        <conv:MuteToIconConverter x:Key="MuteToIcon"/>
        <conv:StageToColorConverter x:Key="StageToColor"/>
    </Window.Resources>

    <Grid>
        <!-- Start Screen -->
        <Grid Visibility="{Binding ShowStartScreen, Converter={StaticResource BoolToVisibility}}">
            <Grid.Background>
                <StaticResource ResourceKey="StartScreenBrush"/>
            </Grid.Background>

            <Border Style="{StaticResource CardPanel}" 
                    MaxWidth="600" 
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="HANGMAN" Style="{StaticResource TitleText}"/>
                    <TextBlock Text="A Modern Word Guessing Game" 
                               Style="{StaticResource SubtitleText}"
                               FontSize="18"
                               Foreground="#7F8C8D"
                               Margin="0,0,0,20"/>

                    <!-- Category and Difficulty in Same Row - COMPACT DESIGN -->
                    <Grid Margin="0,15,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Category Selection -->
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Category:" 
                                       Style="{StaticResource InfoText}"
                                       FontWeight="SemiBold"
                                       FontSize="18"
                                       Foreground="#2C3E50"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Categories}"
                                      SelectedItem="{Binding SelectedCategory}"
                                      Style="{StaticResource ModernComboBox}"
                                      FontSize="16"
                                      Height="40"/>
                        </StackPanel>

                        <!-- Difficulty Selection -->
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Difficulty:" 
                                       Style="{StaticResource InfoText}"
                                       FontWeight="SemiBold"
                                       FontSize="18"
                                       Foreground="#2C3E50"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Difficulties}"
                                      SelectedItem="{Binding SelectedDifficulty}"
                                      Style="{StaticResource ModernComboBox}"
                                      FontSize="16"
                                      Height="40"/>
                        </StackPanel>
                    </Grid>

                    <!-- High Scores -->
                    <Border BorderBrush="#E0E0E0" 
                            BorderThickness="1" 
                            CornerRadius="8" 
                            Padding="15"
                            Margin="0,5,0,15"
                            Background="#F9F9F9">
                        <StackPanel>
                            <TextBlock Text="TOP 5 HIGH SCORES" 
                                       FontSize="16" 
                                       FontWeight="Bold"
                                       Foreground="#2C3E50"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            <ItemsControl ItemsSource="{Binding HighScores}" MaxHeight="120">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" 
                                                   FontSize="13" 
                                                   Foreground="#555"
                                                   Margin="5,1"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Start Button -->
                    <Button Content="START GAME" 
                            Command="{Binding StartGameCommand}"
                            Style="{StaticResource SuccessButton}"
                            FontSize="20"
                            Padding="35,12"
                            Margin="0,8"/>

                    <!-- Bottom Buttons -->
                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,8,0,0">
                        <Button Content="{Binding IsMuted, Converter={StaticResource MuteToIcon}}"
                                Command="{Binding ToggleSoundCommand}"
                                Style="{StaticResource ModernButton}"
                                Padding="40,15"
                                Margin="5"
                                FontSize="11"
                                MinWidth="100"
                                MinHeight="40"
                                ToolTip="Toggle Sound"/>
                        <Button Content="EXIT" 
                                Command="{Binding ExitGameCommand}"
                                Style="{StaticResource DangerButton}"
                                Padding="40,15"
                                Margin="5"
                                FontSize="14"
                                MinWidth="80"
                                MinHeight="40"
                                ToolTip="Exit Game"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Game Screen -->
        <Grid Visibility="{Binding ShowStartScreen, Converter={StaticResource BoolToVisibility}, ConverterParameter=Invert}">
            <Grid.Background>
                <StaticResource ResourceKey="GameBackgroundBrush"/>
            </Grid.Background>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="#2C3E50" 
                    Padding="20,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="Category: " 
                                   Foreground="White" 
                                   FontSize="16"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SelectedCategory}" 
                                   Foreground="#3498DB" 
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <TextBlock Grid.Column="1"
                               Text="HANGMAN" 
                               Foreground="White" 
                               FontSize="28"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"/>

                    <StackPanel Grid.Column="2" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Right">
                        <TextBlock Text="Difficulty: " 
                                   Foreground="White" 
                                   FontSize="16"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SelectedDifficulty}" 
                                   Foreground="#E74C3C" 
                                   FontSize="16"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Game Area -->
            <Grid Grid.Row="1" Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>

                <!-- Hangman Visual -->
                <Border Grid.Column="0" 
                        Style="{StaticResource CardPanel}">
                    <Grid>
                        <!-- FIXED: Added bottom margin to Viewbox to push hangman up -->
                        <Viewbox Stretch="Uniform" Margin="0,0,0,80">
                            <Canvas Width="200" Height="250">
                                <!-- Gallows Base (Always visible) -->
                                <Line X1="20" Y1="230" X2="180" Y2="230" 
                                      Stroke="#8B4513" StrokeThickness="4"/>
                                <Line X1="50" Y1="230" X2="50" Y2="20" 
                                      Stroke="#8B4513" StrokeThickness="4"/>
                                <Line X1="50" Y1="20" X2="130" Y2="20" 
                                      Stroke="#8B4513" StrokeThickness="4"/>
                                <Line X1="130" Y1="20" X2="130" Y2="50" 
                                      Stroke="#8B4513" StrokeThickness="3"/>

                                <!-- Stage 1: Head -->
                                <Ellipse Canvas.Left="105" Canvas.Top="50" 
                                         Width="50" Height="50" 
                                         Stroke="#E74C3C" StrokeThickness="3"
                                         Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=1}"/>

                                <!-- Stage 2: Body -->
                                <Line X1="130" Y1="100" X2="130" Y2="160" 
                                      Stroke="#E74C3C" StrokeThickness="3"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=2}"/>

                                <!-- Stage 3: Left Arm -->
                                <Line X1="130" Y1="120" X2="100" Y2="140" 
                                      Stroke="#E74C3C" StrokeThickness="3"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=3}"/>

                                <!-- Stage 4: Right Arm -->
                                <Line X1="130" Y1="120" X2="160" Y2="140" 
                                      Stroke="#E74C3C" StrokeThickness="3"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=4}"/>

                                <!-- Stage 5: Left Leg -->
                                <Line X1="130" Y1="160" X2="110" Y2="200" 
                                      Stroke="#E74C3C" StrokeThickness="3"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=5}"/>

                                <!-- Stage 6: Right Leg -->
                                <Line X1="130" Y1="160" X2="150" Y2="200" 
                                      Stroke="#E74C3C" StrokeThickness="3"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=6}"/>

                                <!-- Stage 7: Left Eye -->
                                <Ellipse Canvas.Left="118" Canvas.Top="65" 
                                         Width="5" Height="5" 
                                         Fill="#E74C3C"
                                         Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=7}"/>

                                <!-- Stage 8: Right Eye -->
                                <Ellipse Canvas.Left="135" Canvas.Top="65" 
                                         Width="5" Height="5" 
                                         Fill="#E74C3C"
                                         Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=8}"/>

                                <!-- Stage 9: Mouth (Sad) -->
                                <Path Data="M 120,85 Q 130,80 140,85" 
                                      Stroke="#E74C3C" StrokeThickness="2"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=9}"/>

                                <!-- Stage 10: Final detail (tear) -->
                                <Line X1="122" Y1="72" X2="122" Y2="82" 
                                      Stroke="#3498DB" StrokeThickness="2"
                                      Visibility="{Binding HangmanStage, Converter={StaticResource StageVisibility}, ConverterParameter=10}"/>
                            </Canvas>
                        </Viewbox>

                        <!-- FIXED: Moved mistakes counter down with better spacing -->
                        <StackPanel VerticalAlignment="Bottom" Margin="0,0,0,15">
                            <TextBlock Text="Mistakes:" 
                                       Style="{StaticResource InfoText}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"
                                       FontSize="16"/>
                            <TextBlock Text="{Binding HangmanStage, StringFormat='{}{0} / 10'}"
                                       HorizontalAlignment="Center"
                                       FontSize="28"
                                       FontWeight="Bold"
                                       Margin="0,8,0,0"
                                       Foreground="{Binding HangmanStage, Converter={StaticResource StageToColor}}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Word and Keyboard Area -->
                <Border Grid.Column="1" 
                        Style="{StaticResource CardPanel}">
                    <StackPanel>
                        <!-- Word Display -->
                        <TextBlock Text="{Binding DisplayedWord}" 
                                   Style="{StaticResource WordDisplay}"/>

                        <!-- Incorrect Guesses -->
                        <Border BorderBrush="#E0E0E0" 
                                BorderThickness="1" 
                                CornerRadius="8" 
                                Padding="15"
                                Margin="0,20"
                                Background="#FFF3E0">
                            <StackPanel>
                                <TextBlock Text="Incorrect Guesses:" 
                                           FontSize="16" 
                                           FontWeight="SemiBold"
                                           Foreground="#E74C3C"/>
                                <TextBlock Text="{Binding IncorrectGuessesDisplay}" 
                                           FontSize="20"
                                           FontWeight="Bold"
                                           Foreground="#C0392B"
                                           Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Virtual Keyboard -->
                        <TextBlock Text="Click a letter or use your keyboard:" 
                                   Style="{StaticResource InfoText}"
                                   HorizontalAlignment="Center"
                                   Margin="0,10"/>

                        <UniformGrid Columns="9" 
                                     HorizontalAlignment="Center"
                                     Margin="0,10">
                            <Button Content="A" Command="{Binding GuessLetterCommand}" CommandParameter="A" Style="{StaticResource LetterButton}"/>
                            <Button Content="B" Command="{Binding GuessLetterCommand}" CommandParameter="B" Style="{StaticResource LetterButton}"/>
                            <Button Content="C" Command="{Binding GuessLetterCommand}" CommandParameter="C" Style="{StaticResource LetterButton}"/>
                            <Button Content="D" Command="{Binding GuessLetterCommand}" CommandParameter="D" Style="{StaticResource LetterButton}"/>
                            <Button Content="E" Command="{Binding GuessLetterCommand}" CommandParameter="E" Style="{StaticResource LetterButton}"/>
                            <Button Content="F" Command="{Binding GuessLetterCommand}" CommandParameter="F" Style="{StaticResource LetterButton}"/>
                            <Button Content="G" Command="{Binding GuessLetterCommand}" CommandParameter="G" Style="{StaticResource LetterButton}"/>
                            <Button Content="H" Command="{Binding GuessLetterCommand}" CommandParameter="H" Style="{StaticResource LetterButton}"/>
                            <Button Content="I" Command="{Binding GuessLetterCommand}" CommandParameter="I" Style="{StaticResource LetterButton}"/>
                            <Button Content="J" Command="{Binding GuessLetterCommand}" CommandParameter="J" Style="{StaticResource LetterButton}"/>
                            <Button Content="K" Command="{Binding GuessLetterCommand}" CommandParameter="K" Style="{StaticResource LetterButton}"/>
                            <Button Content="L" Command="{Binding GuessLetterCommand}" CommandParameter="L" Style="{StaticResource LetterButton}"/>
                            <Button Content="M" Command="{Binding GuessLetterCommand}" CommandParameter="M" Style="{StaticResource LetterButton}"/>
                            <Button Content="N" Command="{Binding GuessLetterCommand}" CommandParameter="N" Style="{StaticResource LetterButton}"/>
                            <Button Content="O" Command="{Binding GuessLetterCommand}" CommandParameter="O" Style="{StaticResource LetterButton}"/>
                            <Button Content="P" Command="{Binding GuessLetterCommand}" CommandParameter="P" Style="{StaticResource LetterButton}"/>
                            <Button Content="Q" Command="{Binding GuessLetterCommand}" CommandParameter="Q" Style="{StaticResource LetterButton}"/>
                            <Button Content="R" Command="{Binding GuessLetterCommand}" CommandParameter="R" Style="{StaticResource LetterButton}"/>
                            <Button Content="S" Command="{Binding GuessLetterCommand}" CommandParameter="S" Style="{StaticResource LetterButton}"/>
                            <Button Content="T" Command="{Binding GuessLetterCommand}" CommandParameter="T" Style="{StaticResource LetterButton}"/>
                            <Button Content="U" Command="{Binding GuessLetterCommand}" CommandParameter="U" Style="{StaticResource LetterButton}"/>
                            <Button Content="V" Command="{Binding GuessLetterCommand}" CommandParameter="V" Style="{StaticResource LetterButton}"/>
                            <Button Content="W" Command="{Binding GuessLetterCommand}" CommandParameter="W" Style="{StaticResource LetterButton}"/>
                            <Button Content="X" Command="{Binding GuessLetterCommand}" CommandParameter="X" Style="{StaticResource LetterButton}"/>
                            <Button Content="Y" Command="{Binding GuessLetterCommand}" CommandParameter="Y" Style="{StaticResource LetterButton}"/>
                            <Button Content="Z" Command="{Binding GuessLetterCommand}" CommandParameter="Z" Style="{StaticResource LetterButton}"/>
                        </UniformGrid>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Game Controls - FIXED PADDING -->
            <Border Grid.Row="2" 
                    Background="#34495E" 
                    Padding="20,15">
                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Center">
                    <Button Content="MAIN MENU" 
                            Command="{Binding RestartGameCommand}"
                            Style="{StaticResource ModernButton}"
                            Padding="20,12"
                            Margin="5"
                            FontSize="14"
                            MinHeight="40"/>
                    <Button Content="{Binding IsMuted, Converter={StaticResource MuteToIcon}}" 
                            Command="{Binding ToggleSoundCommand}"
                            Style="{StaticResource ModernButton}"
                            Padding="15,12"
                            Margin="5"
                            MinWidth="110"
                            MinHeight="40"
                            FontSize="11"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Game Over Overlay -->
        <Grid Visibility="{Binding ShowGameOverScreen, Converter={StaticResource BoolToVisibility}}"
              Background="#CC000000">
            <Border Style="{StaticResource CardPanel}" 
                    MaxWidth="500" 
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="{Binding GameOverMessage}" 
                               Style="{StaticResource SubtitleText}"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               Margin="0,20"/>

                    <TextBlock Text="{Binding CurrentScore, StringFormat='Score: {0} points'}" 
                               Style="{StaticResource ScoreText}"
                               Margin="0,10"/>

                    <StackPanel Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Margin="0,20,0,0">
                        <Button Content="PLAY AGAIN" 
                                Command="{Binding StartGameCommand}"
                                Style="{StaticResource SuccessButton}"
                                FontSize="18"
                                Padding="25,12"
                                Margin="10,0"
                                MinHeight="45"/>
                        <Button Content="MAIN MENU" 
                                Command="{Binding RestartGameCommand}"
                                Style="{StaticResource ModernButton}"
                                FontSize="18"
                                Padding="25,12"
                                Margin="10,0"
                                MinHeight="45"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
